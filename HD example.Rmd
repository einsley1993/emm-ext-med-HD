---
title: "Section 5. Heart Disease Example"
author: "Yi Li"
date: "22/07/2022"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(regmedint)
# install.packages("cheese")
require(cheese)
# dataset 'heart_disease':
# A: Cholesterol
# M: BP
# Y: HeartDisease
```

## 1. Pre-process data to convert all variables to numeric type
```{r}
heart.disease <- mutate(heart_disease, 
                        sex_M = case_when(Sex == "Male" ~ 1,
                                          TRUE ~ 0),
                        pain_non = case_when(ChestPain == "Non-anginal pain" ~ 1,
                                            TRUE ~ 0),
                        bloodsugar_T = case_when(BloodSugar == TRUE ~ 1,
                                                 TRUE ~ 0),
                        HD = case_when(HeartDisease == "Yes" ~ 1,
                                       TRUE ~ 0)) 
```


## 2. Fit regmedint()
### (1) No EMM terms
```{r}
regmedint_noEMM <- regmedint(data = heart.disease,
                             yvar = "HD",
                             avar = "Cholesterol",
                             mvar = "BP",
                             cvar = c("Age", "sex_M", "pain_non",
                                     "bloodsugar_T", "MaximumHR"),
                             emm_ac_mreg = NULL, 
                             emm_ac_yreg = NULL, 
                             emm_mc_yreg = NULL, 
                             eventvar = NULL,
                             a0 = quantile(heart.disease$Cholesterol, 0.25),
                             a1 = quantile(heart.disease$Cholesterol, 0.75),
                             m_cde = mean(heart.disease$BP),
                             c_cond = c(mean(heart.disease$Age), 
                                        0, 0, 1,
                                        mean(heart.disease$MaximumHR)),
                             mreg = "linear",
                             yreg = "loglinear",
                             interaction = TRUE,
                             casecontrol = FALSE,
                             na_omit = TRUE)
summary(regmedint_noEMM)
```


### (2) EMM by age
(a) Age is set to the 1st quartile:
```{r}
regmedint_age1 <- regmedint(data = heart.disease,
                            yvar = "HD",
                            avar = "Cholesterol",
                            mvar = "BP",
                            cvar = c("Age", "sex_M", "pain_non",
                                     "bloodsugar_T", "MaximumHR"),
                            emm_ac_mreg = c("Age"), 
                            emm_ac_yreg = c("Age"), 
                            emm_mc_yreg = c("Age"), 
                            eventvar = NULL,
                            a0 = quantile(heart.disease$Cholesterol, 0.25),
                            a1 = quantile(heart.disease$Cholesterol, 0.75),
                            m_cde = mean(heart.disease$BP),
                            c_cond = c(quantile(heart.disease$Age, 0.25), 
                                       0, 0, 1,
                                       mean(heart.disease$MaximumHR)),
                            mreg = "linear",
                            yreg = "loglinear",
                            interaction = TRUE,
                            casecontrol = FALSE,
                            na_omit = TRUE)
summary(regmedint_age1)
```


(b) Age is set to the 3rd quartile:
```{r}
regmedint_age2 <- regmedint(data = heart.disease,
                            yvar = "HD",
                            avar = "Cholesterol",
                            mvar = "BP",
                            cvar = c("Age", "sex_M", "pain_non",
                                     "bloodsugar_T", "MaximumHR"),
                            emm_ac_mreg = c("Age"), 
                            emm_ac_yreg = c("Age"), 
                            emm_mc_yreg = c("Age"), 
                            eventvar = NULL,
                            a0 = quantile(heart.disease$Cholesterol, 0.25),
                            a1 = quantile(heart.disease$Cholesterol, 0.75),
                            m_cde = mean(heart.disease$BP),
                            c_cond = c(quantile(heart.disease$Age, 0.75), 
                                       0, 0, 1, 
                                       mean(heart.disease$MaximumHR)),
                            mreg = "linear",
                            yreg = "loglinear",
                            interaction = TRUE,
                            casecontrol = FALSE,
                            na_omit = TRUE)
summary(regmedint_age2)
```



### (3) EMM by sex
(a) Sex is set to male:
```{r}
regmedint_sex1 <- regmedint(data = heart.disease,
                            yvar = "HD",
                            avar = "Cholesterol",
                            mvar = "BP",
                            cvar = c("Age", "sex_M", "pain_non",
                                     "bloodsugar_T", "MaximumHR"),
                            emm_ac_mreg = c("sex_M"), 
                            emm_ac_yreg = c("sex_M"), 
                            emm_mc_yreg = c("sex_M"), 
                            eventvar = NULL,
                            a0 = quantile(heart.disease$Cholesterol, 0.25),
                            a1 = quantile(heart.disease$Cholesterol, 0.75),
                            m_cde = mean(heart.disease$BP),
                            c_cond = c(mean(heart.disease$Age), 
                                       1, 0, 1,
                                       mean(heart.disease$MaximumHR)),
                            mreg = "linear",
                            yreg = "loglinear",
                            interaction = TRUE,
                            casecontrol = FALSE,
                            na_omit = TRUE)
summary(regmedint_sex1)
```

(b) Sex is set to female:
```{r}
regmedint_sex2 <- regmedint(data = heart.disease,
                            yvar = "HD",
                            avar = "Cholesterol",
                            mvar = "BP",
                            cvar = c("Age", "sex_M", "pain_non",
                                     "bloodsugar_T", "MaximumHR"),
                            emm_ac_mreg = c("sex_M"), 
                            emm_ac_yreg = c("sex_M"), 
                            emm_mc_yreg = c("sex_M"), 
                            eventvar = NULL,
                            a0 = quantile(heart.disease$Cholesterol, 0.25),
                            a1 = quantile(heart.disease$Cholesterol, 0.75),
                            m_cde = mean(heart.disease$BP),
                            c_cond = c(mean(heart.disease$Age), 
                                       0, 0, 1,
                                       mean(heart.disease$MaximumHR)),
                            mreg = "linear",
                            yreg = "loglinear",
                            interaction = TRUE,
                            casecontrol = FALSE,
                            na_omit = TRUE)
summary(regmedint_sex2)
```










